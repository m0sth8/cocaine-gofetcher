EXECUTE_PROCESS(COMMAND cocaine-tool app stop --name ${PROJECT_NAME})
EXECUTE_PROCESS(COMMAND cocaine-tool app remove --name ${PROJECT_NAME})
EXECUTE_PROCESS(COMMAND rm -f /var/cache/cocaine/manifests/${PROJECT_NAME})
EXECUTE_PROCESS(COMMAND rm -f ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.tar.gz)
EXECUTE_PROCESS(COMMAND tar -C ${CMAKE_CURRENT_BINARY_DIR} -czf ${PROJECT_NAME}.tar.gz ${PROJECT_NAME} WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
EXECUTE_PROCESS(COMMAND cocaine-tool profile upload --profile=${CMAKE_CURRENT_SOURCE_DIR}/app/gofetcher/default.profile --name=default)
EXECUTE_PROCESS(COMMAND mkdir -p /var/spool/cocaine/${PROJECT_NAME})
EXECUTE_PROCESS(COMMAND cp -f ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME} /var/spool/cocaine/${PROJECT_NAME}/${PROJECT_NAME})
EXECUTE_PROCESS(COMMAND sed -r "s/PROJECT_NAME/${PROJECT_NAME}/g" ${CMAKE_CURRENT_SOURCE_DIR}/app/gofetcher/manifest.json.in OUTPUT_FILE manifest.json WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
EXECUTE_PROCESS(COMMAND cocaine-tool app upload --name ${PROJECT_NAME} --package ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.tar.gz --manifest ${CMAKE_CURRENT_BINARY_DIR}/manifest.json)
EXECUTE_PROCESS(COMMAND cocaine-tool app start --name ${PROJECT_NAME} --profile default)
EXECUTE_PROCESS(COMMAND cocaine-tool call ${PROJECT_NAME} enqueue "\"ping\", \"\"" --timeout 9999)
